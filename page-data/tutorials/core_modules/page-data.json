{"componentChunkName":"component---src-templates-tutorials-js","path":"/tutorials/core_modules/","result":{"data":{"markdownRemark":{"html":"<p>The <b>core modules</b> of the BARK simulator are:</p>\n<ul class=\"list-disc list-inside\">\n<li>The <code class=\"language-text\">World</code> and <code class=\"language-text\">ObservedWorld</code> that contain all agents, the map, goals, and more,</li>\n<li>the <code class=\"language-text\">Agent</code> that represents an entity in the environment that is controlled by a policy,</li>\n<li>the <code class=\"language-text\">MapInterface</code> that contains all map-related functionalities, and</li>\n<li>the <code class=\"language-text\">BehaviorModel</code>, <code class=\"language-text\">ExecutionModel</code>, and <code class=\"language-text\">DynamicModel</code> that specify the characteristics of an agent.\n</br>\n</br></li>\n</ul>\n<p>In this tutorial, a short overview of these components if given.\nFor deeper insights and a comprehensive overview of the components, we refer to our <a href=\"https://bark-simulator.readthedocs.io/en/latest/\" class=\"aggBlueText\">documentation</a>.</p>\n<h2 class=\"text-3xl text-gray-800 mt-10\">World and Observed World</h2>\n<p>The <code class=\"language-text\">World</code> class is in the center of BARK and constains all objects, the map, agents, and all further objects required for the simulation.\nThe world's step function advances the simulation by the given <code class=\"language-text\">delta_time</code> by calling <code class=\"language-text\">DoPlanning</code> and <code class=\"language-text\">DoExecution</code>.\nIn the <code class=\"language-text\">DoPlanning</code> function each agent receives an observed world (a world that is derived from the actual world) and plans its action given that world.\nThis enables introducing perturbation to each agent in BARK, such as measurement uncertainties or occlusions.\nThe <code class=\"language-text\">DoExecution</code> function interpolates the state between the trajectory states produced by the <code class=\"language-text\">DoPlanning</code> function.</p>\n<p>An excerpt of the <code class=\"language-text\">World</code> class and its most important functions and members:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">World</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> commons<span class=\"token operator\">::</span><span class=\"token class-name\">BaseType</span></span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n  <span class=\"token keyword\">explicit</span> <span class=\"token function\">World</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> commons<span class=\"token operator\">::</span>ParamsPtr<span class=\"token operator\">&amp;</span> params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">explicit</span> <span class=\"token function\">World</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> std<span class=\"token operator\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>World<span class=\"token operator\">></span><span class=\"token operator\">&amp;</span> world<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">virtual</span> <span class=\"token operator\">~</span><span class=\"token function\">World</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  std<span class=\"token operator\">::</span>vector<span class=\"token operator\">&lt;</span>ObservedWorld<span class=\"token operator\">></span> <span class=\"token function\">Observe</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> std<span class=\"token operator\">::</span>vector<span class=\"token operator\">&lt;</span>AgentId<span class=\"token operator\">></span><span class=\"token operator\">&amp;</span> agent_ids<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">void</span> <span class=\"token function\">Step</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">float</span><span class=\"token operator\">&amp;</span> delta_time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">void</span> <span class=\"token function\">DoPlanning</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">float</span><span class=\"token operator\">&amp;</span> delta_time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">void</span> <span class=\"token function\">DoExecution</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">float</span><span class=\"token operator\">&amp;</span> delta_time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">virtual</span> std<span class=\"token operator\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>World<span class=\"token operator\">></span> <span class=\"token function\">Clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n <span class=\"token keyword\">private</span><span class=\"token operator\">:</span>\n  world<span class=\"token operator\">::</span>map<span class=\"token operator\">::</span>MapInterfacePtr map_<span class=\"token punctuation\">;</span>\n  AgentMap agents_<span class=\"token punctuation\">;</span>\n  ObjectMap objects_<span class=\"token punctuation\">;</span>\n  std<span class=\"token operator\">::</span>map<span class=\"token operator\">&lt;</span>std<span class=\"token operator\">::</span>string<span class=\"token punctuation\">,</span> EvaluatorPtr<span class=\"token operator\">></span> evaluators_<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">double</span> world_time_<span class=\"token punctuation\">;</span>\n  rtree_agent rtree_agents_<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">bool</span> remove_agents_<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p>The <code class=\"language-text\">ObservedWorld</code> class is at the center of BARK's concept.\nIt enables introducing deterministic perturbations that can be used to benchmark the influence of, e.g., uncertainties.\nAs each agent receives one <code class=\"language-text\">ObservedWorld</code> for planning, theses are agent specific and additionally store the <code class=\"language-text\">AgentId</code> (of the observing agent).</p>\n<p>An excerpt of the <code class=\"language-text\">ObservedWorld</code> class showing some of the additional functionalities:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ObservedWorld</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">World</span></span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n  <span class=\"token function\">ObservedWorld</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> WorldPtr<span class=\"token operator\">&amp;</span> world<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> AgentId<span class=\"token operator\">&amp;</span> ego_agent_id<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span>\n    <span class=\"token function\">World</span><span class=\"token punctuation\">(</span>world<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">ego_agent_id_</span><span class=\"token punctuation\">(</span>ego_agent_id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">~</span><span class=\"token function\">ObservedWorld</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  FrontRearAgents <span class=\"token function\">GetAgentFrontRear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n  std<span class=\"token operator\">::</span>shared_ptr<span class=\"token operator\">&lt;</span><span class=\"token keyword\">const</span> Agent<span class=\"token operator\">></span> <span class=\"token function\">GetEgoAgent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">World</span><span class=\"token operator\">::</span><span class=\"token function\">GetAgent</span><span class=\"token punctuation\">(</span>ego_agent_id_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  AgentId <span class=\"token function\">GetEgoAgentId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> ego_agent_id_<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">const</span> std<span class=\"token operator\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>BehaviorModel<span class=\"token operator\">></span> <span class=\"token function\">GetEgoBehaviorModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">World</span><span class=\"token operator\">::</span><span class=\"token function\">GetAgent</span><span class=\"token punctuation\">(</span>ego_agent_id_<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">GetBehaviorModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">virtual</span> State <span class=\"token function\">CurrentEgoState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">World</span><span class=\"token operator\">::</span><span class=\"token function\">GetAgent</span><span class=\"token punctuation\">(</span>ego_agent_id_<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">GetCurrentState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  Point2d <span class=\"token function\">CurrentEgoPosition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">World</span><span class=\"token operator\">::</span><span class=\"token function\">GetAgent</span><span class=\"token punctuation\">(</span>ego_agent_id_<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">GetCurrentPosition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n <span class=\"token keyword\">private</span><span class=\"token operator\">:</span>\n  AgentId ego_agent_id_<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 class=\"text-3xl text-gray-800 mt-10\">Agent</h2>\n<p>The agents (vehicles) in BARK are dynamic objects that have a behavior, execution, and dynamic model.\nAdditionally, to model intent, each agent in BARK has a goal definition.\nThe behavior model plans a trajectory to reach the defined goal and the execution model makes the trajectory executable by the dynamic system.\nThe dynamic model can be used by both, the behavior and execution model, to create dynamically feasible trajectories.\nBARK additionally offers a high-level map routing called the <code class=\"language-text\">RoadGraph</code> that stores <code class=\"language-text\">RoadCorridor</code> and <code class=\"language-text\">LaneCorridor</code>.\nRoadCorridors are multiple concatenated roads that each contain lanes.\n<code class=\"language-text\">LaneCorridors</code> are multiple concatenated lanes that are consecutive within the <code class=\"language-text\">RoadCorridors</code>.\n<br />\nExcerpt of the <code class=\"language-text\">Agent</code> class:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Agent</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span></span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n  <span class=\"token keyword\">friend</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">World</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">Agent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> State<span class=\"token operator\">&amp;</span> initial_state<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">const</span> BehaviorModelPtr<span class=\"token operator\">&amp;</span> behavior_model_ptr<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">const</span> DynamicModelPtr<span class=\"token operator\">&amp;</span> dynamic_model_ptr<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">const</span> ExecutionModelPtr<span class=\"token operator\">&amp;</span> execution_model<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">const</span> geometry<span class=\"token operator\">::</span>Polygon<span class=\"token operator\">&amp;</span> shape<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">const</span> commons<span class=\"token operator\">::</span>ParamsPtr<span class=\"token operator\">&amp;</span> params<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">const</span> GoalDefinitionPtr<span class=\"token operator\">&amp;</span> goal_definition <span class=\"token operator\">=</span> <span class=\"token function\">GoalDefinitionPtr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">const</span> MapInterfacePtr<span class=\"token operator\">&amp;</span> map_interface <span class=\"token operator\">=</span> <span class=\"token function\">MapInterfacePtr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">const</span> geometry<span class=\"token operator\">::</span>Model3D<span class=\"token operator\">&amp;</span> model_3d <span class=\"token operator\">=</span> geometry<span class=\"token operator\">::</span><span class=\"token function\">Model3D</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n <span class=\"token keyword\">private</span><span class=\"token operator\">:</span>\n  BehaviorModelPtr behavior_model_<span class=\"token punctuation\">;</span>\n  DynamicModelPtr dynamic_model_<span class=\"token punctuation\">;</span>\n  ExecutionModelPtr execution_model_<span class=\"token punctuation\">;</span>\n  RoadCorridorPtr road_corridor_<span class=\"token punctuation\">;</span>\n  StateActionHistory history_<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">uint32_t</span> max_history_length_<span class=\"token punctuation\">;</span>\n  GoalDefinitionPtr goal_definition_<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 class=\"text-3xl text-gray-800 mt-10\">Map Interface</h2>\n<p>The <code class=\"language-text\">MapInterface</code> implements all map-related functionalities – the map itself, routing, and an abstraction layer.\nThe <code class=\"language-text\">RoadGraph</code> enables querying the shortest route from a start to a goal position returning a sequence of roads and lane identifieres.\nEach agent has a routing in form of multiple connected roads called the <code class=\"language-text\">RoadCorridor</code> the agent (vehicle) should follow these and is only allowed to stay within this <code class=\"language-text\">RoadCorridor</code>.</p>\n<p>The <code class=\"language-text\">RoadCorridor</code> polygon is depicted in light blue and the LaneCorridor's contour are depicted as blue lines in the figure below.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 615px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7ab755d99384a2525fa3c772453ffd48/f6b72/roadcorridor_%5B0%2C%202%2C%204%5D.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA9hAAAPYQGoP6dpAAAA+ElEQVQoz6WQzWrCQBSF53kLWvANfI7YSui22LrWbNxooqVBC4KKoRA1VGOy8I9k7pyOJioSkqY4cObODNxvzrkM/1hCiD/FarqNt66N94RmqPdsqRm0vgNnvZVEQhhyEBE45zc6vzGlMYXStFBpRlU51ev5SbPQGjh41kZYehvJ5BIaJnSEBUEAlifq17eP0osJ292e7kQZkUluaeKy8bjaoxUK6iccbx8BhUj9nGUNmGKgMXZRlMDFencBpjrMinoG6uNVApjqMA/QmLh4VE0s8kTOA+zIGT5UPzC/22HcaFo+yq9D/PiH+4Aibgy5wO5AF8ciA/gL89RQrs/JbE0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"RoadCorridor\"\n        title=\"RoadCorridor\"\n        src=\"/static/7ab755d99384a2525fa3c772453ffd48/f6b72/roadcorridor_%5B0%2C%202%2C%204%5D.png\"\n        srcset=\"/static/7ab755d99384a2525fa3c772453ffd48/772e8/roadcorridor_%5B0%2C%202%2C%204%5D.png 200w,\n/static/7ab755d99384a2525fa3c772453ffd48/e17e5/roadcorridor_%5B0%2C%202%2C%204%5D.png 400w,\n/static/7ab755d99384a2525fa3c772453ffd48/f6b72/roadcorridor_%5B0%2C%202%2C%204%5D.png 615w\"\n        sizes=\"(max-width: 615px) 100vw, 615px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Excerpt of the <code class=\"language-text\">RoadCorridor</code> class:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">RoadCorridor</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n  <span class=\"token function\">GetLeftRightLaneCorridor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> Point2d<span class=\"token operator\">&amp;</span> pt<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">static</span> std<span class=\"token operator\">::</span>size_t <span class=\"token function\">GetHash</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">const</span> XodrDrivingDirection<span class=\"token operator\">&amp;</span> driving_direction<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">const</span> std<span class=\"token operator\">::</span>vector<span class=\"token operator\">&lt;</span>XodrRoadId<span class=\"token operator\">></span><span class=\"token operator\">&amp;</span> road_ids<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// calculate hash using driving_direction and road_ids</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n  <span class=\"token punctuation\">}</span>\n\n  Roads roads_<span class=\"token punctuation\">;</span>\n  Polygon road_polygon_<span class=\"token punctuation\">;</span>\n  std<span class=\"token operator\">::</span>vector<span class=\"token operator\">&lt;</span>LaneCorridorPtr<span class=\"token operator\">></span> unique_lane_corridors_<span class=\"token punctuation\">;</span>\n  std<span class=\"token operator\">::</span>vector<span class=\"token operator\">&lt;</span>XodrRoadId<span class=\"token operator\">></span> road_ids_<span class=\"token punctuation\">;</span>\n  std<span class=\"token operator\">::</span>map<span class=\"token operator\">&lt;</span>LaneId<span class=\"token punctuation\">,</span> LaneCorridorPtr<span class=\"token operator\">></span> lane_corridors_<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>","frontmatter":{"title":"Core Modules"}}},"pageContext":{"slug":"/tutorials/core_modules/"}},"staticQueryHashes":["1503014085","3885506533","4018511916","63159454"]}